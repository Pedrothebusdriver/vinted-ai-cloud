<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vinted Pi â€“ Uploader</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 1rem; }
    header { display:flex; align-items:center; justify-content:space-between; }
    .card { border:1px solid #ddd; border-radius:12px; padding:1rem; margin:.5rem 0; }
    .row { display:flex; gap:.5rem; align-items:center; }
    button { padding:.7rem 1rem; border-radius:10px; border:1px solid #ccc; background:#fff; }
    .pill { font-size:.8rem; padding:.2rem .5rem; border-radius:999px; border:1px solid #ddd; }
    .thumb { width:64px; height:64px; object-fit:cover; border-radius:8px; border:1px solid #ddd; }
    .draft { display:flex; gap:.5rem; align-items:center; justify-content:space-between; }
  </style>
</head>
<body>
  <header>
    <h2>Vinted Pi</h2>
    <form id="uploadForm">
      <input type="file" name="files" id="files" multiple accept="image/*" capture="environment" />
      <button type="submit">Add Item</button>
    </form>
  </header>

  <div id="status"></div>

  <h3>Drafts</h3>
  <div id="drafts"></div>

<script>
async function refreshDrafts(){
  const res = await fetch('/api/drafts');
  const data = await res.json();
  const wrap = document.getElementById('drafts');
  wrap.innerHTML='';
  data.forEach(d => {
    const el = document.createElement('div');
    el.className='card draft';
    el.innerHTML = `
      <div class="row">
        ${(d.thumbs||[]).map(t=>`<img class='thumb' src='${t}' />`).join('')}
        <div>
          <div><strong>${d.title || '(no title yet)'}</strong></div>
          <div class="row">
            <span class="pill">Brand: ${d.brand?.value||'-'} (${d.brand?.confidence||'-'})</span>
            <span class="pill">Size: ${d.size?.value||'-'} (${d.size?.confidence||'-'})</span>
            <span class="pill">Type: ${d.item_type?.value||'-'} (${d.item_type?.confidence||'-'})</span>
            <span class="pill">Colour: ${d.colour?.value||'-'} (${d.colour?.confidence||'-'})</span>
          </div>
        </div>
      </div>
      <div class="row">
        <button onclick="location.href='/draft/'+${d.id}">Review</button>
      </div>`;
    wrap.appendChild(el);
  })
}
refreshDrafts();

const form = document.getElementById('uploadForm');
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const files = document.getElementById('files').files;
  if(!files.length){ alert('Pick some photos'); return; }
  const fd = new FormData();
  for (const f of files) fd.append('files', f);
  const res = await fetch('/api/upload', { method: 'POST', body: fd });
  const j = await res.json();
  document.getElementById('status').textContent = j.message || 'Uploaded';
  refreshDrafts();
  form.reset();
});
</script>
</body>
</html>
